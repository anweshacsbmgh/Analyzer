function dP = RBCfun(t,P,fV,fH,L,J,birth,death,nV,nH,vGridU,vGridL,hGridL,hGridU,DH,DV)
% size(-(repmat(JV(:)',[nH.^2,1])*(fV(:).*P(:)) + repmat(JH(:)',[nV.^2,1])*(fH(:).*P(:))))
% size((repmat(Lv(:)',[nH.^2,1])*P(:)+repmat(Lh(:)',[nV.^2,1])*P(:)))
% size(birth(:)-death(:))
% P=reshape(P,[nV,nH]);
dP = -(J(:).*(nV-1)/(vGridU-vGridL)*(fV(:).*P(:)) + J'.*(nH-1)/(hGridU-hGridL)*(fH(:).*P(:)))...
   +L*P(:)+birth(:)-death(:).*(P>0);
%  dP = -(JV.*(fV.*P) + JH.*(fH.*P))...
%      +(Lv.*P+Lh.*P)+birth-death.*sign(P);
%  dP = dP(:);
t
%  keyboard
end

